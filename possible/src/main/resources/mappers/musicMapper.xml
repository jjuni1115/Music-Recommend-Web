<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="music">
    <insert id="insert" parameterType="java.util.List">
       insert ignore into music(id,title,artist,genre,release_time,adult_authen) values
       <foreach collection="list" item="i" separator=",">
       (#{i.id},#{i.title},#{i.artist},#{i.genre},#{i.release_time},#{i.adult_authen})
       </foreach>
    </insert>

    <select id="search" resultType="result">
        select title,artist
        from music
        where title like CONCAT('%',#{keyword},'%');
    </select>

    <insert id="playlist" parameterType="add_playlist">
        insert ignore into rel values((select ID from playlist where user_ID=#{user_ID}),(select ID from music where title=#{title} and artist=#{artist}))
    </insert>

    <select id="load" resultType="result">
        SELECT title, artist
        FROM music,user,playlist,rel
        WHERE user.ID=playlist.user_ID AND playlist.ID=rel.playlist_ID AND rel.music_ID=music.ID AND user.ID=#{id} AND playlist.list_name=#{list_name}
    </select>

    <select id="search_artist" resultType="result">
        select title,artist
        from music
        where artist like CONCAT('%',#{keyword},'%');
    </select>

    <insert id="create_playlist" parameterType="playlist">
        insert ignore into playlist(list_name,release_time,user_ID) values(#{list_name},#{release_date},#{user_ID});
    </insert>

    <select id="load_playlist" resultType="String">
        select list_name
        from playlist
        where user_ID=#{id};
    </select>

</mapper>